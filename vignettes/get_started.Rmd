---
title: "Get started with SAVM"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Get started with SAVM}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(SAVM)
library(sf)
library(stars)
```

# Introduction

This vignette provides an overview of the workflow offered by the **Submerged Aquatic Vegetation (SAV) Model R package**. The package allows users to import spatial and tabular data related to SAV presence and habitat conditions in aquatic ecosystems. The presented in this vignette provide an overview of the functionalities built into the package and presents a workflow from user input to model predictions. 




# User workflow 

## Reading file

Reading files. 

```{r}
le_bound <- system.file("example", "lake_erie.gpkg", package = "SAVM") |>
  sf::st_read() |>
  sf::st_transform(crs = 3857)

# read and create
study_zone <- system.file("example", "study_zone.geojson", package = "SAVM") |>
  read_sav(spacing = 2000)

study_depth <- stars::read_stars(system.file("example", "le_bathy.tiff", package = "SAVM"))

#'  le_pt <- system.file("example", "le_points.geojson", package = "SAVM") |>
#'      sf::st_read(quiet = TRUE)

fetch <- compute_fetch(study_zone$points, le_bound, n_quad_seg = 10, max_dist = 15000)

depth <- stars::st_extract(study_depth, study_zone$points |> sf::st_transform(crs = sf::st_crs(study_depth)))

d_inputs <- data.frame(
  depth = depth$le_bathy.tiff,
  fetch = units::set_units(fetch$mean_fetch$mean_fetch, "km")
)

# get input
res <- sav_model(d_inputs)
# Visualize results

library(ggplot2)
library(units)

# Example scatterplot with improved aesthetics
ggplot(res, aes(x = Fetch, y = Cover)) +
  geom_point(color = "#2C7BB6", size = 3, alpha = 0.7) + # Blue points, slightly transparent
  geom_smooth(method = "lm", color = "#D7191C", linetype = "dashed", se = FALSE) + # Red trendline
  labs(
    x = "Fetch Distance (km)",
    y = "SAV Cover (%)",
    title = "Relationship Between Fetch and SAV Cover"
  ) +
  theme_minimal(base_size = 14) + # Clean minimal theme
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5), # Centered bold title
    axis.title = element_text(face = "bold"),
    axis.text = element_text(color = "black"),
    panel.grid.major = element_line(color = "gray80", linetype = "dashed")
  )

plot(res$Fetch, res$Cover)

study_zone$points$Cover <- res$Cover
study_zone$points$PA <- res$PA
mapview::mapview(study_zone$points, zcol = "Cover", layer.name = "Predictions", zlim = c(0, 100)) +
  mapview::mapview(study_zone$polygon, legend = FALSE, col.regions = "#000000", alpha.regions = 0.2, layer.name = "Area of interest")

mapview::mapview(study_zone$points, zcol = "PA", layer.name = "Predictions", zlim = c(0, 100)) +
  mapview::mapview(study_zone$polygon, legend = FALSE, col.regions = "#000000", alpha.regions = 0.2, layer.name = "Area of interest")
```



# Questions 

## Inputs 

- Naming rules
  - longitude
  - latitude
  - depth_m or depth
  - fetch or fetch_km
  - substrate 
  - secchi or turbidity

- default porjection 3857? https://epsg.io/3857

- should the user ne 

## Fetch 

- default number of direction per quadrant 
- what would the most natural way to use wind weight
  - Should wind-weights be defined per point?

## Model

- Post-hoc

  - Why not applying upfront?

  - Should the parameters of the Chambers and Kalff's equation be editable?

> (VMaxA)0.5 = 1.33 log(D) + 1.40, correct?


# Plot 

- 1,2 or 4 => depending on type and predictor combinations
- map using tmap?
